modules = ["c-clang14", "bash", "cpp-clang14", "go-1.23", "python-base-3.12", "postgresql-16", "web"]

[nix]
channel = "stable-24_05"
packages = ["ipscan"]

[workflows]
runButton = "Process-and-Train"

[[workflows.workflow]]
name = "3proxy"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "chmod +x /src/scripts/setup.sh"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "./src/scripts/setup.sh"

[[workflows.workflow]]
name = "3proxy-full"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "chmod +x /src/scripts/setup.sh"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "/src/scripts/setup.sh"

[[workflows.workflow]]
name = "3proxy-mobile"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "chmod +x /src/scripts/setup.sh"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "/src/scripts/setup.sh"

[[workflows.workflow]]
name = "Mobile-Proxy"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "mkdir -p bin obj logs"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd src && make"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd .. && ./bin/mobile_proxy"

[[workflows.workflow]]
name = "Proxy-Server"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "mkdir -p bin obj"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd src && make proxy_server"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd .. && ./bin/proxy_server"

[[workflows.workflow]]
name = "Download-Data"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd gpt2-llm.c"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "python dev/data/tinyshakespeare.py"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "python train_gpt2.py"

[[workflows.workflow]]
name = "Train-CPU"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd gpt2-llm.c"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make train_gpt2"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "OMP_NUM_THREADS=4 ./train_gpt2"

[[workflows.workflow]]
name = "Train-GPU"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd gpt2-llm.c"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "make train_gpt2fp32cu"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "./train_gpt2fp32cu"

[[workflows.workflow]]
name = "Process-and-Train"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "python main.py --setup --sample-data --process --train"

[[workflows.workflow]]
name = "Process-Data"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "python main.py --process"

[[workflows.workflow]]
name = "Classify-with-GPT4o"
author = 39603852
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "python main.py --classify"

[deployment]
run = ["sh", "-c", "cd src && ../bin/mobile_proxy"]
